{extend name="common/admin" /}
{block name="admin-main"}
<div class="cl pd-5 bg-1 bk-gray mt-20">
        <span class="l">
            <a href="javascript:;" onclick="menuAdd({$menuId==''?0:$menuId})" class="btn btn-primary radius">
                <i class="Hui-iconfont">&#xe600;</i> 添加菜单
            </a>
        </span>
        <span class="r">共有数据：<strong>{$menu_num}</strong> 条</span>
</div>
<table class="table table-border table-bordered table-bg">
    <tbody>
    {if condition="$menuId eq '' "}
        <!--主菜单-->
        <thead>
            <tr>
                <th class="text-c" scope="col" colspan="10">前台菜单列表</th>
            </tr>
            <tr class="text-c">
                <th>ID</th>
                <th>名称</th>
                <th class="hidden-xs">描述</th>
                <th>地址</th>
                <th>图标</th>
                <th class="hidden-xs">更新时间</th>
                <th class="hidden-xs">属性</th>
                <th>权限</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        {volist name="menu_font" id="menu"}
            <tr class="text-c">
                <td>{$menu.menu_id}</td>
                <td><a href="/Admin_system/menu/menuId/{$menu.menu_id}">{$menu.menu_content}</a></td>
                <td class="hidden-xs">{$menu.menu_desc}</td>
                <td>{$menu.menu_address}</td>
                <td><i class="iconfont1 {$menu.menu_icon}"></i></td>
                <td class="hidden-xs">{$menu.menu_last_update|backDate}</td>
                <td class="hidden-xs">{$menu.menu_property}</td>
                <td>{$menu.menu_authority}</td>
                {if condition="$menu.menu_is_view eq 1"}
                <td class="td-status"><span class="label label-success radius">已启用</span></td>
                {else/}
                <td class="td-status"><span class="label label-default radius">已禁用</span></td>
                {/if}
                <td class="td-manage">
                    {if condition="$menu.menu_is_view eq 1"}
                    <a style="text-decoration:none" onClick="menuStop(this,'{$menu.menu_id}')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a> 
                    {else/}
                    <a onClick="menuStart(this,'{$menu.menu_id}')" href="javascript:;" title="启用" style="text-decoration:none"><i class="Hui-iconfont">&#xe615;</i></a>
                    {/if}
                    <a title="编辑" href="javascript:;" onclick="editMenu('{$menu.menu_id}')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a> 
                    <a title="删除" href="javascript:;" onclick="admin_del(this,'1')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
                </td>
            </tr>
        {/volist}
        <thead>
            <tr>
                <th class="text-c" scope="col" colspan="10">用户菜单列表</th>
            </tr>
            <tr class="text-c">
                <th>ID</th>
                <th>名称</th>
                <th class="hidden-xs">描述</th>
                <th>地址</th>
                <th>图标</th>
                <th class="hidden-xs">更新时间</th>
                <th class="hidden-xs">属性</th>
                <th>权限</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        {volist name="menu_user" id="menu"}
            <tr class="text-c">
                <td>{$menu.menu_id}</td>
                <td><a href="/Admin_system/menu/menuId/{$menu.menu_id}">{$menu.menu_content}</a></td>
                <td class="hidden-xs">{$menu.menu_desc}</td>
                <td>{$menu.menu_address}</td>
                <td><i class="iconfont1 {$menu.menu_icon}"></i></td>
                <td class="hidden-xs">{$menu.menu_last_update|backDate}</td>
                <td class="hidden-xs">{$menu.menu_property}</td>
                <td>{$menu.menu_authority}</td>
                {if condition="$menu.menu_is_view eq 1"}
                <td class="td-status"><span class="label label-success radius">已启用</span></td>
                {else/}
                <td class="td-status"><span class="label label-default radius">已禁用</span></td>
                {/if}
                <td class="td-manage">
                    {if condition="$menu.menu_is_view eq 1"}
                    <a style="text-decoration:none" onClick="menuStop(this,'{$menu.menu_id}')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a> 
                    {else/}
                    <a onClick="menuStart(this,'{$menu.menu_id}')" href="javascript:;" title="启用" style="text-decoration:none"><i class="Hui-iconfont">&#xe615;</i></a>
                    {/if}
                    <a title="编辑" href="javascript:;" onclick="editMenu('{$menu.menu_id}')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a> 
                    <a title="删除" href="javascript:;" onclick="admin_del(this,'1')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
                </td>
            </tr>
        {/volist}
        <thead>
                <tr>
                    <th class="text-c" scope="col" colspan="10">后台菜单列表</th>
                </tr>
                <tr class="text-c">
                    <th>ID</th>
                    <th>名称</th>
                    <th class="hidden-xs">描述</th>
                    <th>地址</th>
                    <th>图标</th>
                    <th class="hidden-xs">更新时间</th>
                    <th class="hidden-xs">属性</th>
                    <th>权限</th>
                    <th >状态</th>
                    <th>操作</th>
                </tr>
        </thead>
        {volist name="menu_admin" id="menu"}
            <tr class="text-c">
                <td>{$menu.menu_id}</td>
                <td><a href="/Admin_system/menu/menuId/{$menu.menu_id}">{$menu.menu_content}</a></td>
                <td class="hidden-xs">{$menu.menu_desc}</td>
                <td>{$menu.menu_address}</td>
                <td><i class="Hui-iconfont">{$menu.menu_icon}</i></td>
                <td class="hidden-xs">{$menu.menu_last_update|backDate}</td>
                <td class="hidden-xs">{$menu.menu_property}</td>
                <td>{$menu.menu_authority}</td>
                {if condition="$menu.menu_is_view eq 1"}
                <td class="td-status"><span class="label label-success radius">已启用</span></td>
                {else/}
                <td class="td-status"><span class="label label-default radius">已禁用</span></td>
                {/if}
                <td class="td-manage">
                    {if condition="$menu.menu_is_view eq 1"}
                    <a style="text-decoration:none" onClick="menuStop(this,'{$menu.menu_id}')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a> 
                    {else/}
                    <a onClick="menuStart(this,'{$menu.menu_id}')" href="javascript:;" title="启用" style="text-decoration:none"><i class="Hui-iconfont">&#xe615;</i></a>
                    {/if}
                    <a title="编辑" href="javascript:;" onclick="editMenu('{$menu.menu_id}')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a> 
                    <a title="删除" href="javascript:;" onclick="admin_del(this,'1')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
                </td>
            </tr>
        {/volist}
    {else /}
        <!--子菜单 -->
        {if condition="count($menu_childs) eq 0 "}
            <tr class="text-c"><td colspan="11">该菜单下没有子菜单</td></tr>
        {else /}
            <thead>
                <tr>
                    <th class="text-c" scope="col" colspan="11">用户菜单列表</th>
                </tr>
                <tr class="text-c">
                    <th ><input type="checkbox" name="" value=""></th>
                    <th class="hidden-xs">ID</th>
                    <th>名称</th>
                    <th class="hidden-xs">描述</th>
                    <th>地址</th>
                    <th>图标</th>
                    <th>父Id</th>
                    <th class="hidden-xs">更新时间</th>
                    <th class="hidden-xs">属性</th>
                    <th>权限</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            {volist name="menu_childs" id="menu"}
            <tr class="text-c">
                <td><input type="checkbox" value="1" name=""></td>
                <td class="hidden-xs">{$menu.menu_id}</td>
                <td><a href="/Admin_system/menu/menuId/{$menu.menu_id}">{$menu.menu_content}</a></td>
                <td class="hidden-xs">{$menu.menu_desc}</td>
                <td>{$menu.menu_address}</td>
                <td><i class="Hui-iconfont">{$menu.menu_icon}</i></td>
                <td>{$menu.menu_parent_id}</td>
                <td class="hidden-xs">{$menu.menu_last_update|backDate}</td>
                <td class="hidden-xs">{$menu.menu_property}</td>
                <td>{$menu.menu_authority}</td>
                {if condition="$menu.menu_is_view eq 1"}
                <td class="td-status"><span class="label label-success radius">已启用</span></td>
                {else/}
                <td class="td-status"><span class="label label-default radius">已禁用</span></td>
                {/if}
                <td class="td-manage">
                    {if condition="$menu.menu_is_view eq 1"}
                    <a style="text-decoration:none" onClick="menuStop(this,'{$menu.menu_id}')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a> 
                    {else/}
                    <a onClick="menuStart(this,'{$menu.menu_id}')" href="javascript:;" title="启用" style="text-decoration:none"><i class="Hui-iconfont">&#xe615;</i></a>
                    {/if}
                    <a title="编辑" href="javascript:;" onclick="editMenu('{$menu.menu_id}')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a> 
                    <a title="删除" href="javascript:;" onclick="admin_del(this,'1')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>
                </td>
            </tr>
            {/volist}
        {/if}
    {/if}
    </tbody>
</table>
{/block}
{block name="script"}
<script type="text/javascript">
/*管理员-停用*/
function menuStop(obj,id){
	layer.confirm('确认要停用吗？',function(index){
        //此处请求后台程序，下方是成功后的前台处理……
        $.ajax({
			type: 'POST',
			url: '/Admin_system/menuStop/id/'+id,
			data: {},
			//这两个设置项必填
			contentType: false,
            processData: false,
            dataType: 'jsonp',
			calback: "callback",
			success: function(data){
				console.log(data);
				$(obj).parents("tr").find(".td-manage").prepend('<a onClick="menuStart(this,'+id+')" href="javascript:;" title="启用" style="text-decoration:none"><i class="Hui-iconfont">&#xe615;</i></a>');
                $(obj).parents("tr").find(".td-status").html('<span class="label label-default radius">已禁用</span>');
                $(obj).remove();
                layer.msg(data["msg"],{icon: 5,time:1000});
			},
			error:function(data) {
				console.log(data.msg);
			},
		});	
		
	});
}

/*管理员-启用*/
function menuStart(obj,id){
	layer.confirm('确认要启用吗？',function(index){
		//此处请求后台程序，下方是成功后的前台处理……
		$.ajax({
			type: 'POST',
			url: '/Admin_system/menuStart/id/'+id,
			data: {},
			//这两个设置项必填
			contentType: false,
            processData: false,
            dataType: 'jsonp',
			calback: "callback",
			success: function(data){
                console.log(data);
				$(obj).parents("tr").find(".td-manage").prepend('<a onClick="menuStop(this,'+id+')" href="javascript:;" title="停用" style="text-decoration:none"><i class="Hui-iconfont">&#xe631;</i></a>');
                $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已启用</span>');
                $(obj).remove();
                layer.msg(data["msg"], {icon: 6,time:1000});
			},
			error:function(data) {
				console.log(data.msg);
			},
		});	
		
	});
}
function menuAdd(id){
    layer.open({
         title:"增加标签",
         type: 2,
         content: '/Admin_system/menuAdd/id/'+id   //content可以是字符串，可以是DOM，也可以是一个URL
        ,btn: ['确认', '取消']
        ,area: ['450px', '350px']
        ,yes: function(index, layero){
            //按钮【按钮一】的回调
            var formData = new FormData($(window.frames[0].document).find("form")[0]);
            $.ajax({
                type: 'POST',
                url: '/Admin_label/add/id/'+id,
                data: formData,
                //这两个设置项必填
                contentType: false,
                processData: false,
                dataType: 'jsonp',
			    calback: "callback",
                success: function(data){
                    console.log(data);
                    layer.msg(data['msg'],{icon: 1,time:1000});
                    layer.close(index);
                },
                error:function(data) {
                    console.log(data.msg);
                },
            });	
        }
        ,no: function(index, layero){
            //按钮【按钮二】的回调
            layer.close(index);
            return false
            //return false 开启该代码可禁止点击该按钮关闭
        }
        ,cancel: function(){ 
            //右上角关闭回调
            
            //return false 开启该代码可禁止点击该按钮关闭
        }
    });
}
function editMenu(id){
     layer.open({
         title:"修改标签",
        type: 2,
        content: '/Admin_system/editMenu/id/'+id   //content可以是字符串，可以是DOM，也可以是一个URL
        ,btn: ['确认', '取消']
        ,area: ['450px', '350px']
        ,yes: function(index, layero){
            //按钮【按钮一】的回调
            var formData = new FormData($(window.frames[0].document).find("form")[0]);
            $.ajax({
                type: 'POST',
                url: '/Admin_label/edit/id/'+id,
                data: formData,
                //这两个设置项必填
                contentType: false,
                processData: false,
                dataType: 'jsonp',
			    calback: "callback",
                success: function(data){
                    console.log(data);
                    layer.msg(data['msg'],{icon: 1,time:1000});
                    layer.close(index);
                },
                error:function(data) {
                    console.log(data.msg);
                },
            });	
        }
        ,no: function(index, layero){
            //按钮【按钮二】的回调
            layer.close(index);
            return false
            //return false 开启该代码可禁止点击该按钮关闭
        }
        ,cancel: function(){ 
            //右上角关闭回调
            
            //return false 开启该代码可禁止点击该按钮关闭
        }
    });
   
}
</script> 
{/block}